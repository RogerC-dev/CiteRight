<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CiteRight - 法律研究助手</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <!-- Inter + Noto Sans TC Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap"
    rel="stylesheet">
  <!-- Shared Theme -->
  <link rel="stylesheet" href="../styles/shared-theme.css">
  <style>
    /* Page Layout */
    .page-wrapper {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Main Header */
    .main-header {
      background: var(--gradient-primary);
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--primary);
    }

    .logo-text {
      font-size: 20px;
      font-weight: 700;
      color: #fff;
    }

    .logo-subtitle {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.85);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .btn-header {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: var(--radius-sm);
      color: #fff;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
    }

    .btn-header:hover {
      background: rgba(255, 255, 255, 0.25);
      color: #fff;
    }

    /* Navigation */
    .main-nav {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 72px;
      z-index: 99;
    }

    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 4px;
      padding: 0 24px;
    }

    .nav-tab {
      padding: 14px 20px;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-tab:hover {
      color: var(--primary);
      background: var(--primary-soft);
    }

    .nav-tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      background: var(--bg-page);
      padding: 24px;
    }

    .content-inner {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Tab Content */
    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* Section Headers */
    .section-header {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .section-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* Filter Card */
    .filter-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-elegant);
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .filter-group label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 6px;
    }

    .filter-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    /* Mode Cards */
    .mode-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .mode-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .mode-card:hover {
      border-color: var(--primary);
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
    }

    .mode-icon {
      width: 64px;
      height: 64px;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      margin: 0 auto 16px;
    }

    .mode-card h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .mode-card p {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
    }

    .stat-number {
      font-size: 32px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Schedule Cards */
    .schedule-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .schedule-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      transition: all 0.2s;
    }

    .schedule-card:hover {
      box-shadow: var(--shadow);
    }

    .schedule-card.urgent {
      border-left: 4px solid var(--destructive);
    }

    .schedule-card.soon {
      border-left: 4px solid var(--warning);
    }

    .schedule-card.normal {
      border-left: 4px solid var(--success);
    }

    .schedule-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }

    .schedule-card.urgent .schedule-icon {
      background: var(--destructive-soft);
      color: var(--destructive);
    }

    .schedule-card.soon .schedule-icon {
      background: var(--warning-soft);
      color: var(--warning);
    }

    .schedule-card.normal .schedule-icon {
      background: var(--success-soft);
      color: var(--success);
    }

    .schedule-info {
      flex: 1;
    }

    .schedule-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .schedule-count {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 2px;
    }

    /* Flashcard List */
    .flashcard-controls {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .flashcard-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .flashcard-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }

    .flashcard-item:hover {
      border-color: var(--primary);
      box-shadow: var(--shadow);
    }

    .flashcard-content {
      flex: 1;
    }

    .flashcard-question {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .flashcard-meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .flashcard-tag {
      padding: 4px 10px;
      background: var(--primary-soft);
      color: var(--primary);
      border-radius: var(--radius-full);
      font-size: 11px;
      font-weight: 500;
    }

    .flashcard-status {
      padding: 4px 10px;
      border-radius: var(--radius-full);
      font-size: 11px;
      font-weight: 500;
    }

    .flashcard-status.learning {
      background: var(--warning-soft);
      color: var(--warning);
    }

    .flashcard-status.mastered {
      background: var(--success-soft);
      color: var(--success);
    }

    .flashcard-next {
      font-size: 11px;
      color: var(--text-secondary);
    }

    .flashcard-actions {
      display: flex;
      gap: 8px;
    }

    /* Progress Section */
    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .progress-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .progress-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
    }

    .progress-card h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
    }

    .progress-bar-lg {
      background: var(--surface-muted);
      border-radius: var(--radius-sm);
      height: 24px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 12px;
      font-weight: 600;
      transition: width 0.5s ease;
    }

    /* Subject Cards */
    .subject-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .subject-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      transition: all 0.2s;
    }

    .subject-card:hover {
      box-shadow: var(--shadow);
    }

    .subject-card h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .subject-stats div {
      padding: 4px 0;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .progress-mini {
      background: var(--surface-muted);
      border-radius: var(--radius-sm);
      height: 6px;
      overflow: hidden;
      margin-top: 12px;
    }

    .progress-mini-bar {
      height: 100%;
      background: var(--gradient-primary);
      transition: width 0.5s ease;
    }

    /* Wrong Questions */
    .wrong-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .wrong-item {
      background: var(--destructive-soft);
      border: 1px solid var(--destructive);
      border-left-width: 4px;
      border-radius: var(--radius);
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .wrong-question {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .wrong-details {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .wrong-subject {
      padding: 4px 10px;
      background: var(--destructive);
      color: #fff;
      border-radius: var(--radius-full);
      font-size: 11px;
      font-weight: 500;
    }

    .wrong-date {
      font-size: 11px;
      color: var(--text-secondary);
    }

    /* Admin Section */
    .admin-actions {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .import-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 24px;
    }

    .import-section h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
    }

    .upload-area {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 48px 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .upload-area:hover {
      border-color: var(--primary);
      background: var(--primary-soft);
    }

    .upload-icon {
      font-size: 48px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .upload-hint {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 8px;
    }

    /* Admin Table */
    .admin-table {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .admin-table thead {
      background: var(--surface-muted);
    }

    .admin-table th {
      padding: 12px 16px;
      text-align: left;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border);
    }

    .admin-table td {
      padding: 12px 16px;
      font-size: 13px;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }

    .admin-table tr:last-child td {
      border-bottom: none;
    }

    .admin-table tr:hover {
      background: var(--bg-page);
    }

    .status-badge {
      padding: 4px 10px;
      border-radius: var(--radius-full);
      font-size: 11px;
      font-weight: 500;
    }

    .status-badge.published {
      background: var(--success-soft);
      color: var(--success);
    }

    .status-badge.draft {
      background: var(--warning-soft);
      color: var(--warning);
    }

    /* Audit Section */
    .audit-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
    }

    .audit-section h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
    }

    .audit-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .audit-item {
      display: flex;
      gap: 16px;
      align-items: center;
      padding: 12px;
      background: var(--bg-page);
      border-radius: var(--radius-sm);
    }

    .audit-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--primary-soft);
      color: var(--primary);
    }

    .audit-action {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .audit-meta {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 2px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .main-header {
        padding: 12px 16px;
      }

      .nav-inner {
        padding: 0 16px;
        overflow-x: auto;
      }

      .main-content {
        padding: 16px;
      }

      .filter-grid {
        grid-template-columns: 1fr;
      }

      .mode-grid {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .progress-overview {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <script src="../scripts/navigation-loader.js"></script>
</head>

<body>
  <div class="page-wrapper">
    <!-- Header -->
    <header class="main-header">
      <div class="header-inner">
        <div class="logo-area">
          <div class="logo-icon">
            <i class="bi bi-journal-bookmark-fill"></i>
          </div>
          <div>
            <div class="logo-text">CiteRight</div>
            <div class="logo-subtitle">司律考題練習題庫系統</div>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn-header" data-theme-toggle>
            <i class="bi bi-moon-fill"></i>
          </button>
          <a href="subscription.html" class="btn-header">
            <i class="bi bi-gem"></i> 升級
          </a>
          <a href="ai-legal-interface.html" class="btn-header">
            <i class="bi bi-robot"></i> AI 助手
          </a>
          <div class="btn-header" id="userArea">
            <i class="bi bi-person-circle"></i>
            <span id="userName">登入</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav">
      <div class="nav-inner">
        <button class="nav-tab active" data-tab="practice">
          <i class="bi bi-collection-fill"></i> 練習模式
        </button>
        <button class="nav-tab" data-tab="flashcards">
          <i class="bi bi-layers-fill"></i> 快閃卡
        </button>
        <button class="nav-tab" data-tab="progress">
          <i class="bi bi-graph-up"></i> 學習追蹤
        </button>
        <button class="nav-tab" data-tab="admin">
          <i class="bi bi-gear-fill"></i> 題庫管理
        </button>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <div class="content-inner">
        <!-- Practice Tab -->
        <div class="tab-panel active" id="practice-panel">
          <div class="section-header">
            <h1 class="section-title">練習模式</h1>
            <p class="section-subtitle">整合歷屆司法官/律師考題，選擇適合您的練習方式</p>
          </div>

          <!-- Filters -->
          <div class="filter-card">
            <div class="filter-grid">
              <div class="filter-group">
                <label>考試別</label>
                <select class="form-select" id="exam-type">
                  <option value="">全部</option>
                  <option value="judicial">司法官</option>
                  <option value="lawyer">律師</option>
                </select>
              </div>
              <div class="filter-group">
                <label>年度</label>
                <select class="form-select" id="exam-year">
                  <option value="">全部</option>
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                </select>
              </div>
              <div class="filter-group">
                <label>科目</label>
                <select class="form-select" id="subject">
                  <option value="">全部</option>
                  <option value="civil">民法</option>
                  <option value="criminal">刑法</option>
                  <option value="administrative">行政法</option>
                </select>
              </div>
              <div class="filter-group">
                <label>題型</label>
                <select class="form-select" id="question-type">
                  <option value="">全部</option>
                  <option value="choice">選擇題</option>
                  <option value="essay">申論題</option>
                </select>
              </div>
              <div class="filter-group" style="grid-column: span 2;">
                <label>關鍵字搜尋</label>
                <input type="text" class="form-control" id="keyword-search" placeholder="輸入關鍵字...">
              </div>
            </div>
            <div class="filter-actions">
              <button class="btn btn-secondary" id="reset-filters">
                <i class="bi bi-arrow-counterclockwise"></i> 重置
              </button>
              <button class="btn btn-primary" id="apply-filters">
                <i class="bi bi-funnel"></i> 套用篩選
              </button>
            </div>
          </div>

          <!-- Mode Cards -->
          <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; color: var(--text-primary);">
            <i class="bi bi-grid-3x3-gap"></i> 選擇練習模式
          </h3>
          <div class="mode-grid">
            <div class="mode-card" data-mode="historical">
              <div class="mode-icon" style="background: var(--icon-blue-bg); color: var(--icon-blue-fg);">
                <i class="bi bi-book-half"></i>
              </div>
              <h4>歷屆考題</h4>
              <p>按年度練習歷屆考題</p>
              <button class="btn btn-primary btn-sm">開始練習</button>
            </div>
            <div class="mode-card" data-mode="simulation">
              <div class="mode-icon" style="background: var(--icon-purple-bg); color: var(--icon-purple-fg);">
                <i class="bi bi-clipboard-check"></i>
              </div>
              <h4>模擬考試</h4>
              <p>模擬真實考試情境</p>
              <button class="btn btn-primary btn-sm">開始測驗</button>
            </div>
            <div class="mode-card" data-mode="mixed">
              <div class="mode-icon" style="background: var(--icon-orange-bg); color: var(--icon-orange-fg);">
                <i class="bi bi-shuffle"></i>
              </div>
              <h4>混合練習</h4>
              <p>隨機混合不同年度題目</p>
              <button class="btn btn-primary btn-sm">隨機練習</button>
            </div>
            <div class="mode-card" data-mode="favorites">
              <div class="mode-icon" style="background: var(--icon-amber-bg); color: var(--icon-amber-fg);">
                <i class="bi bi-star-fill"></i>
              </div>
              <h4>收藏題庫</h4>
              <p>複習已收藏的題目</p>
              <button class="btn btn-primary btn-sm">檢視收藏</button>
            </div>
          </div>

          <!-- Stats -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number" id="stat-total">-</div>
              <div class="stat-label">總題數</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="stat-practiced">-</div>
              <div class="stat-label">已練習</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="stat-accuracy">-</div>
              <div class="stat-label">正確率</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="stat-to-review">-</div>
              <div class="stat-label">待複習</div>
            </div>
          </div>
        </div>

        <!-- Flashcards Tab -->
        <div class="tab-panel" id="flashcards-panel">
          <div class="section-header">
            <h1 class="section-title">快閃卡複習系統</h1>
            <p class="section-subtitle">使用間隔重複演算法，提升記憶效果</p>
          </div>

          <!-- Schedule Cards -->
          <div class="schedule-grid">
            <div class="schedule-card urgent">
              <div class="schedule-icon">
                <i class="bi bi-exclamation-circle-fill"></i>
              </div>
              <div class="schedule-info">
                <div class="schedule-title">今日待複習</div>
                <div class="schedule-count" id="urgent-count">- 張卡片</div>
              </div>
              <button class="btn btn-primary btn-sm">
                <i class="bi bi-play-fill"></i> 立即複習
              </button>
            </div>
            <div class="schedule-card soon">
              <div class="schedule-icon">
                <i class="bi bi-clock-fill"></i>
              </div>
              <div class="schedule-info">
                <div class="schedule-title">明日預定</div>
                <div class="schedule-count" id="soon-count">- 張卡片</div>
              </div>
              <button class="btn btn-secondary btn-sm">查看詳情</button>
            </div>
            <div class="schedule-card normal">
              <div class="schedule-icon">
                <i class="bi bi-calendar-check"></i>
              </div>
              <div class="schedule-info">
                <div class="schedule-title">本週預定</div>
                <div class="schedule-count" id="normal-count">- 張卡片</div>
              </div>
              <button class="btn btn-secondary btn-sm">查看詳情</button>
            </div>
          </div>

          <!-- Flashcard Manager -->
          <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">
            <i class="bi bi-stack"></i> 快閃卡管理
          </h3>
          <div class="flashcard-controls">
            <button class="btn btn-primary" id="create-flashcard">
              <i class="bi bi-plus-lg"></i> 建立新卡片
            </button>
            <button class="btn btn-secondary" id="import-flashcards">
              <i class="bi bi-upload"></i> 批次匯入
            </button>
            <select class="form-select" style="width: auto;" id="flashcard-filter">
              <option value="all">全部卡片</option>
              <option value="new">新卡片</option>
              <option value="learning">學習中</option>
              <option value="mastered">已掌握</option>
            </select>
          </div>

          <div class="flashcard-list" id="flashcard-list">
            <div class="flashcard-item">
              <div class="flashcard-content">
                <div class="flashcard-question">民法第 184 條第 1 項規定之侵權行為要件為何？</div>
                <div class="flashcard-meta">
                  <span class="flashcard-tag">民法</span>
                  <span class="flashcard-status learning">學習中</span>
                  <span class="flashcard-next">下次複習: 2天後</span>
                </div>
              </div>
              <div class="flashcard-actions">
                <button class="btn-icon" title="編輯"><i class="bi bi-pencil"></i></button>
                <button class="btn-icon" title="刪除"><i class="bi bi-trash"></i></button>
              </div>
            </div>
          </div>
        </div>

        <!-- Progress Tab -->
        <div class="tab-panel" id="progress-panel">
          <div class="progress-header">
            <div class="section-header" style="margin-bottom: 0;">
              <h1 class="section-title">學習追蹤分析</h1>
              <p class="section-subtitle">查看您的學習進度與成效分析</p>
            </div>
            <select class="form-select" style="width: auto;" id="time-range">
              <option value="7">最近 7 天</option>
              <option value="30" selected>最近 30 天</option>
              <option value="90">最近 90 天</option>
              <option value="all">全部</option>
            </select>
          </div>

          <!-- Progress Overview -->
          <div class="progress-overview">
            <div class="progress-card">
              <h4><i class="bi bi-bar-chart-fill"></i> 練習進度</h4>
              <div class="progress-bar-lg">
                <div class="progress-fill" style="width: 65%;">65%</div>
              </div>
              <p style="font-size: 13px; color: var(--text-secondary);">已完成 1,582 / 2,435 題</p>
            </div>
            <div class="progress-card">
              <h4><i class="bi bi-graph-up-arrow"></i> 正確率趨勢</h4>
              <div
                style="height: 120px; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);">
                <i class="bi bi-bar-chart-line" style="font-size: 48px; opacity: 0.3;"></i>
              </div>
            </div>
          </div>

          <!-- Subject Breakdown -->
          <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">
            <i class="bi bi-pie-chart-fill"></i> 科目分析
          </h3>
          <div class="subject-grid">
            <div class="subject-card">
              <h4>民法</h4>
              <div class="subject-stats">
                <div>練習題數: 456</div>
                <div>正確率: 78%</div>
                <div>弱點: 物權編</div>
              </div>
              <div class="progress-mini">
                <div class="progress-mini-bar" style="width: 78%;"></div>
              </div>
            </div>
            <div class="subject-card">
              <h4>刑法</h4>
              <div class="subject-stats">
                <div>練習題數: 389</div>
                <div>正確率: 71%</div>
                <div>弱點: 共犯理論</div>
              </div>
              <div class="progress-mini">
                <div class="progress-mini-bar" style="width: 71%;"></div>
              </div>
            </div>
            <div class="subject-card">
              <h4>行政法</h4>
              <div class="subject-stats">
                <div>練習題數: 342</div>
                <div>正確率: 69%</div>
                <div>弱點: 行政救濟</div>
              </div>
              <div class="progress-mini">
                <div class="progress-mini-bar" style="width: 69%;"></div>
              </div>
            </div>
          </div>

          <!-- Wrong Questions -->
          <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">
            <i class="bi bi-exclamation-triangle-fill"></i> 錯題本
          </h3>
          <div class="wrong-list">
            <div class="wrong-item">
              <div class="wrong-content">
                <div class="wrong-question">關於公司法中董事會之召集，下列敘述何者正確？</div>
                <div class="wrong-details">
                  <span class="wrong-subject">公司法</span>
                  <span class="wrong-date">錯誤 3 次 | 最後練習: 2024-03-15</span>
                </div>
              </div>
              <button class="btn btn-outline-danger btn-sm">
                <i class="bi bi-arrow-repeat"></i> 重新練習
              </button>
            </div>
          </div>
        </div>

        <!-- Admin Tab -->
        <div class="tab-panel" id="admin-panel">
          <div class="section-header">
            <h1 class="section-title">題庫管理後台</h1>
            <p class="section-subtitle">管理者專用：題目維護與批次匯入</p>
          </div>

          <!-- Admin Actions -->
          <div class="admin-actions">
            <button class="btn btn-primary" id="add-question">
              <i class="bi bi-plus-lg"></i> 新增題目
            </button>
            <button class="btn btn-primary" id="batch-import">
              <i class="bi bi-upload"></i> 批次匯入
            </button>
            <button class="btn btn-secondary" id="export-data">
              <i class="bi bi-download"></i> 匯出資料
            </button>
            <button class="btn btn-secondary" id="audit-log">
              <i class="bi bi-clock-history"></i> 查看日誌
            </button>
          </div>

          <!-- Import Section -->
          <div class="import-section">
            <h4><i class="bi bi-cloud-upload"></i> 批次匯入題庫</h4>
            <div class="upload-area" id="upload-area">
              <div class="upload-icon"><i class="bi bi-folder-plus"></i></div>
              <p style="color: var(--text-primary); font-weight: 500;">拖曳檔案至此或點擊上傳</p>
              <p class="upload-hint">支援格式: JSON, CSV, PDF</p>
              <input type="file" id="file-upload" accept=".json,.csv,.pdf" hidden>
            </div>
            <div id="import-progress" style="display: none; padding: 20px;">
              <div class="progress-container">
                <div class="progress-bar" id="import-progress-bar" style="width: 0%;"></div>
              </div>
              <p id="import-status" style="text-align: center; margin-top: 12px; color: var(--text-secondary);">正在處理...
              </p>
            </div>
          </div>

          <!-- Question Table -->
          <div style="margin-bottom: 24px;">
            <h4 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">
              <i class="bi bi-list-ul"></i> 題目列表
            </h4>
            <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
              <input type="text" class="form-control" placeholder="搜尋題目..." id="admin-search"
                style="flex: 1; min-width: 200px;">
              <select class="form-select" id="admin-status" style="width: auto;">
                <option value="all">全部狀態</option>
                <option value="published">已發布</option>
                <option value="draft">草稿</option>
              </select>
            </div>
            <table class="admin-table">
              <thead>
                <tr>
                  <th>題號</th>
                  <th>題目內容</th>
                  <th>考試別</th>
                  <th>年度</th>
                  <th>科目</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>#2024-001</td>
                  <td>關於民法第 184 條侵權行為之規定...</td>
                  <td>司法官</td>
                  <td>2024</td>
                  <td>民法</td>
                  <td><span class="status-badge published">已發布</span></td>
                  <td>
                    <button class="btn-icon" title="編輯"><i class="bi bi-pencil"></i></button>
                    <button class="btn-icon" title="預覽"><i class="bi bi-eye"></i></button>
                    <button class="btn-icon" title="刪除"><i class="bi bi-trash"></i></button>
                  </td>
                </tr>
                <tr>
                  <td>#2024-002</td>
                  <td>刑法共犯理論中，關於幫助犯...</td>
                  <td>律師</td>
                  <td>2024</td>
                  <td>刑法</td>
                  <td><span class="status-badge draft">草稿</span></td>
                  <td>
                    <button class="btn-icon" title="編輯"><i class="bi bi-pencil"></i></button>
                    <button class="btn-icon" title="預覽"><i class="bi bi-eye"></i></button>
                    <button class="btn-icon" title="刪除"><i class="bi bi-trash"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Audit Section -->
          <div class="audit-section">
            <h4><i class="bi bi-clock-history"></i> 稽核紀錄</h4>
            <div class="audit-list">
              <div class="audit-item">
                <div class="audit-icon"><i class="bi bi-pencil-square"></i></div>
                <div>
                  <div class="audit-action">題目 #2024-001 已更新</div>
                  <div class="audit-meta">管理員: admin@example.com | 2024-03-20 14:30</div>
                </div>
              </div>
              <div class="audit-item">
                <div class="audit-icon"><i class="bi bi-cloud-arrow-up"></i></div>
                <div>
                  <div class="audit-action">批次匯入 150 題成功</div>
                  <div class="audit-meta">管理員: admin@example.com | 2024-03-20 10:15</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Scripts -->
  <script src="../scripts/api-config.js"></script>
  <script src="../scripts/theme-manager.js"></script>
  <script src="../scripts/flashcard-handler.js"></script>
  <script src="../scripts/quiz-handler.js"></script>
  <script>
    // Tab Navigation
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', function () {
        const targetId = this.dataset.tab + '-panel';

        // Update tabs
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        // Update panels
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        document.getElementById(targetId).classList.add('active');
      });
    });

    // Filter Actions
    document.getElementById('apply-filters')?.addEventListener('click', function () {
      const filters = {
        examType: document.getElementById('exam-type').value,
        examYear: document.getElementById('exam-year').value,
        subject: document.getElementById('subject').value,
        questionType: document.getElementById('question-type').value,
        keyword: document.getElementById('keyword-search').value,
      };
      console.log('Applying filters:', filters);
    });

    document.getElementById('reset-filters')?.addEventListener('click', function () {
      document.getElementById('exam-type').value = '';
      document.getElementById('exam-year').value = '';
      document.getElementById('subject').value = '';
      document.getElementById('question-type').value = '';
      document.getElementById('keyword-search').value = '';
    });

    // Mode Card Click
    document.querySelectorAll('.mode-card').forEach(card => {
      card.querySelector('button')?.addEventListener('click', async function (e) {
        e.stopPropagation();
        const mode = card.dataset.mode;
        console.log('Starting mode:', mode);
        alert('開始練習: ' + card.querySelector('h4').textContent);
      });
    });

    // Flashcard Actions
    document.getElementById('create-flashcard')?.addEventListener('click', function () {
      const front = prompt('輸入問題/正面內容：');
      if (front) {
        const back = prompt('輸入答案/背面內容：');
        if (back) {
          flashcardHandler.createFlashcard({ front, back })
            .then(() => alert('快閃卡已建立！'))
            .catch(err => alert('建立失敗：' + err.message));
        }
      }
    });

    // File Upload
    const uploadArea = document.getElementById('upload-area');
    const fileUpload = document.getElementById('file-upload');

    uploadArea?.addEventListener('click', () => fileUpload?.click());
    uploadArea?.addEventListener('dragover', e => {
      e.preventDefault();
      uploadArea.style.borderColor = 'var(--primary)';
    });
    uploadArea?.addEventListener('dragleave', e => {
      e.preventDefault();
      uploadArea.style.borderColor = 'var(--border)';
    });
    uploadArea?.addEventListener('drop', e => {
      e.preventDefault();
      uploadArea.style.borderColor = 'var(--border)';
      if (e.dataTransfer.files.length) {
        handleFileUpload(e.dataTransfer.files[0]);
      }
    });
    fileUpload?.addEventListener('change', function () {
      if (this.files.length) {
        handleFileUpload(this.files[0]);
      }
    });

    function handleFileUpload(file) {
      console.log('Uploading:', file.name);
      const progress = document.getElementById('import-progress');
      const bar = document.getElementById('import-progress-bar');
      const status = document.getElementById('import-status');

      uploadArea.style.display = 'none';
      progress.style.display = 'block';

      let p = 0;
      const interval = setInterval(() => {
        p += 10;
        bar.style.width = p + '%';
        if (p === 50) status.textContent = '解析檔案中...';
        if (p === 80) status.textContent = '驗證資料中...';
        if (p >= 100) {
          clearInterval(interval);
          status.textContent = '匯入完成！';
          setTimeout(() => {
            uploadArea.style.display = 'block';
            progress.style.display = 'none';
            bar.style.width = '0%';
            status.textContent = '正在處理...';
            fileUpload.value = '';
            alert('成功匯入：' + file.name);
          }, 2000);
        }
      }, 300);
    }

    // Load Stats
    async function loadStats() {
      try {
        if (window.quizHandler) {
          const stats = await window.quizHandler.getStats();
          document.getElementById('stat-total').textContent = stats.totalQuestions || 0;
          document.getElementById('stat-practiced').textContent = stats.practiced || 0;
          document.getElementById('stat-accuracy').textContent = (stats.accuracy || 0) + '%';
          document.getElementById('stat-to-review').textContent = stats.toReview || 0;
        }
      } catch (err) {
        console.error('Error loading stats:', err);
      }
    }

    // Load Flashcard Schedule
    async function loadFlashcardSchedule() {
      try {
        const result = await flashcardHandler.getDueFlashcards();
        if (result.success) {
          const { summary } = result.data;
          document.getElementById('urgent-count').textContent = (summary.urgent + summary.soon + summary.normal) + ' 張卡片';
          document.getElementById('soon-count').textContent = summary.soon + ' 張卡片';
          document.getElementById('normal-count').textContent = summary.normal + ' 張卡片';
        }
      } catch (err) {
        console.error('Error loading flashcard schedule:', err);
      }
    }

    // Initialize
    loadStats();
    loadFlashcardSchedule();
  </script>
</body>

</html>