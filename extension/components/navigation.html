<!-- Shared Navigation Component for Extension Pages -->
<nav class="extension-nav" id="extensionNav">
    <div class="nav-container">
        <div class="nav-brand">
            <a href="index.html#/intro" class="nav-logo">
                <span class="logo-icon">âš–ï¸</span>
                <span class="logo-text">CiteRight</span>
            </a>
        </div>

        <div class="nav-links">
            <a href="index.html#/intro" class="nav-link" data-nav-key="intro">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">ç”¢å“ç¸½è¦½</span>
            </a>
            <a href="exam-bank.html" class="nav-link" data-nav-key="exam-bank">
                <span class="nav-icon">ğŸ“š</span>
                <span class="nav-text">é¡Œåº«ç·´ç¿’</span>
            </a>
            <a href="ai-legal-interface.html" class="nav-link" data-nav-key="ai-chat">
                <span class="nav-icon">ğŸ¤–</span>
                <span class="nav-text">AI æ³•å¾‹åŠ©æ‰‹</span>
            </a>
            <a href="subscription.html" class="nav-link" data-nav-key="subscription">
                <span class="nav-icon">ğŸ’³</span>
                <span class="nav-text">æ–¹æ¡ˆè³‡è¨Š</span>
            </a>
            <a href="index.html#/flashcards" class="nav-link" data-nav-key="flashcards">
                <span class="nav-icon">ğŸ“‡</span>
                <span class="nav-text">å¿«é–ƒå¡</span>
            </a>
            <a href="index.html#/progress" class="nav-link" data-nav-key="progress">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-text">å­¸ç¿’è¿½è¹¤</span>
            </a>
            <a href="index.html#/admin" class="nav-link" data-nav-key="admin">
                <span class="nav-icon">ğŸ› ï¸</span>
                <span class="nav-text">é¡Œåº«ç®¡ç†</span>
            </a>
        </div>

        <div class="nav-actions">
            <a href="subscription.html" class="nav-action-btn" title="æ–¹æ¡ˆä»‹ç´¹">
                ğŸ’³
            </a>
            <a href="index.html#/intro" class="nav-upgrade-btn" id="navUpgradeBtn">
                <span>âœ¨</span>
                <span>å‡ç´š</span>
            </a>
        </div>
    </div>
</nav>

<style>
    .extension-nav {
        background: white;
        border-bottom: 1px solid #e0e0e0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    .nav-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 60px;
    }

    .nav-brand {
        display: flex;
        align-items: center;
    }

    .nav-logo {
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        color: #1890ff;
        font-weight: 600;
        font-size: 18px;
        transition: opacity 0.2s;
    }

    .nav-logo:hover {
        opacity: 0.8;
    }

    .logo-icon {
        font-size: 24px;
    }

    .logo-text {
        font-weight: 600;
    }

    .nav-links {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 1;
        justify-content: center;
        flex-wrap: wrap;
    }

    .nav-link {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        text-decoration: none;
        color: #4a5568;
        border-radius: 999px;
        transition: all 0.2s;
        font-size: 14px;
        font-weight: 500;
        border: 1px solid transparent;
    }

    .nav-link:hover {
        border-color: #bae7ff;
        background: #f0faff;
        color: #096dd9;
    }

    .nav-link.active {
        background: #1890ff;
        color: white;
        border-color: #1890ff;
        box-shadow: 0 4px 12px rgba(24, 144, 255, 0.25);
    }

    .nav-icon {
        font-size: 16px;
    }

    .nav-text {
        white-space: nowrap;
    }

    .nav-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-action-btn {
        width: 40px;
        height: 40px;
        border: none;
        background: #f5f5f5;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: all 0.2s;
        color: #666;
        text-decoration: none;
    }

    .nav-action-btn:hover {
        background: #e6f7ff;
        color: #1890ff;
    }

    .nav-upgrade-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
        color: white;
        border-radius: 8px;
        text-decoration: none;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3);
    }

    .nav-upgrade-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(24, 144, 255, 0.4);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .nav-text {
            display: none;
        }

        .nav-link {
            padding: 8px 12px;
        }

        .nav-container {
            padding: 0 12px;
        }
    }
</style>

<script>
    (function () {
        document.addEventListener('DOMContentLoaded', function () {
            const nav = document.getElementById('extensionNav');
            if (!nav) {
                return;
            }

            const forcedKey = nav.dataset.forceActive;

            function detectActiveKey() {
                if (forcedKey) {
                    return forcedKey;
                }

                const path = window.location.pathname;
                const hash = window.location.hash.replace('#/', '') || 'intro';

                if (path.includes('exam-bank.html')) {
                    return 'exam-bank';
                }
                if (path.includes('ai-legal-interface.html')) {
                    return 'ai-chat';
                }
                if (path.includes('subscription.html')) {
                    return 'subscription';
                }

                return hash;
            }

            function updateActiveLink() {
                const activeKey = detectActiveKey();
                const links = nav.querySelectorAll('.nav-link');

                links.forEach((link) => {
                    const key = link.getAttribute('data-nav-key');
                    if (key === activeKey) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }

            window.addEventListener('hashchange', updateActiveLink);
            updateActiveLink();

            const links = nav.querySelectorAll('.nav-link');
            links.forEach((link) => {
                link.addEventListener('click', function (event) {
                    const href = this.getAttribute('href');

                    if (href && href.includes('#/') && window.extensionRouter) {
                        const route = href.split('#/')[1];
                        if (route) {
                            event.preventDefault();
                            window.extensionRouter.navigate(route);
                        }
                    }
                });
            });
        });
    })();
</script>