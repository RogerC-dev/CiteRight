<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³•æºæ¢æ¸¬å™¨ (CiteRight) - å®˜æ–¹APIæ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.8;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            text-align: center;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            padding: 10px;
            background: #ecf0f1;
            border-radius: 8px;
            border-left: 5px solid #3498db;
        }
        .test-section {
            background: #f8f9fa;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 5px solid #28a745;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .api-status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .status-checking { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

        button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover {
            background: linear-gradient(45deg, #2980b9, #21618c);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .manual-test {
            background: #e8f4f8;
            border: 2px solid #3498db;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .manual-test input {
            padding: 8px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            margin: 5px;
            font-size: 14px;
        }

        #results {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #dee2e6;
            max-height: 500px;
            overflow-y: auto;
        }

        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border-left: 5px solid #e74c3c;
        }

        .case-highlight {
            background: #ffeaa7;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #2d3436;
        }

        .feature-badge {
            display: inline-block;
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ æ³•æºæ¢æ¸¬å™¨ (CiteRight) - å®˜æ–¹APIç‰ˆæœ¬</h1>
        <p style="text-align: center; font-size: 18px; color: #7f8c8d;">
            <strong>å°ˆæ¥­ç‰ˆï¼š</strong>æ•´åˆå°ç£å¸æ³•é™¢å®˜æ–¹é–‹æ”¾è³‡æ–™APIï¼Œæä¾›çœŸå¯¦æ³•å¾‹æ¡ˆè™ŸæŸ¥è©¢æœå‹™
            <span class="feature-badge">å®˜æ–¹API</span>
            <span class="feature-badge">å³æ™‚æŸ¥è©¢</span>
            <span class="feature-badge">å°ˆæ¥­ç´š</span>
        </p>

        <div id="apiStatus" class="api-status status-checking">
            ğŸ”„ æ­£åœ¨æª¢æŸ¥å¾Œç«¯æœå‹™å™¨ç‹€æ…‹...
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <button onclick="checkServerHealth()">ğŸ” æª¢æŸ¥æœå‹™å™¨</button>
            <button onclick="getStats()">ğŸ“Š è³‡æ–™åº«çµ±è¨ˆ</button>
            <button onclick="manualSync()">ğŸ”„ æ‰‹å‹•åŒæ­¥</button>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“‹ æ¸¬è©¦æ¡ˆä¾‹ 1ï¼šæœ€é«˜æ³•é™¢åˆ¤æ±º</h2>
        <div class="test-section">
            <p>æœ€é«˜æ³•é™¢æ–¼<span class="case-highlight">110å¹´åº¦å°ä¸Šå­—ç¬¬1234è™Ÿ</span>åˆ¤æ±ºä¸­èªç‚ºï¼Œç•¶äº‹äººå°æ–¼å¥‘ç´„æ¢æ¬¾ä¹‹è§£é‡‹æ‡‰ä»¥èª ä¿¡åŸå‰‡ç‚ºæº–ã€‚å¦å¯åƒè¦‹<span class="case-highlight">109å¹´åº¦å°ä¸Šå­—ç¬¬5678è™Ÿ</span>åˆ¤æ±ºåŠ<span class="case-highlight">111å¹´åº¦å°ä¸Šå­—ç¬¬9012è™Ÿ</span>åˆ¤æ±ºã€‚</p>

            <p>ç›¸é—œåˆ¤æ±ºäº¦åŒ…æ‹¬<span class="case-highlight">110å¹´åº¦å°ä¸Šå­—ç¬¬2468è™Ÿ</span>ä»¥åŠ<span class="case-highlight">109å¹´åº¦å°ä¸Šå­—ç¬¬1357è™Ÿ</span>ç­‰é‡è¦å…ˆä¾‹ã€‚</p>
        </div>
    </div>

    <div class="container">
        <h2>âš–ï¸ æ¸¬è©¦æ¡ˆä¾‹ 2ï¼šæ†²æ³•æ³•åº­åˆ¤æ±º</h2>
        <div class="test-section">
            <p>æ†²æ³•æ³•åº­<span class="case-highlight">111å¹´æ†²åˆ¤å­—ç¬¬13è™Ÿ</span>åˆ¤æ±ºå®£å‘Šç›¸é—œæ³•æ¢é•æ†²ï¼Œæ­¤åˆ¤æ±ºå½±éŸ¿æ·±é ã€‚å¦å¯åƒè€ƒ<span class="case-highlight">110å¹´æ†²åˆ¤å­—ç¬¬8è™Ÿ</span>åˆ¤æ±ºä¹‹è¦‹è§£ã€‚</p>

            <p>æ­¤å¤–ï¼Œ<span class="case-highlight">112å¹´æ†²åˆ¤å­—ç¬¬5è™Ÿ</span>åˆ¤æ±ºé€²ä¸€æ­¥é—¡é‡‹ç›¸é—œæ†²æ³•åŸå‰‡ï¼Œèˆ‡<span class="case-highlight">109å¹´æ†²åˆ¤å­—ç¬¬15è™Ÿ</span>åˆ¤æ±ºç›¸å‘¼æ‡‰ã€‚</p>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“œ æ¸¬è©¦æ¡ˆä¾‹ 3ï¼šå¤§æ³•å®˜è§£é‡‹</h2>
        <div class="test-section">
            <p>å¤§æ³•å®˜<span class="case-highlight">é‡‹å­—ç¬¬748è™Ÿ</span>è§£é‡‹ç¢ºç«‹åŒæ€§å©šå§»ä¹‹æ†²æ³•åœ°ä½ã€‚ç›¸é—œè§£é‡‹å°šåŒ…æ‹¬<span class="case-highlight">é‡‹å­—ç¬¬554è™Ÿ</span>ã€<span class="case-highlight">é‡‹å­—ç¬¬626è™Ÿ</span>ç­‰ã€‚</p>

            <p><span class="case-highlight">é‡‹å­—ç¬¬809è™Ÿ</span>è§£é‡‹å‰‡é‡å°åˆ‘äº‹è¨´è¨Ÿç¨‹åºæå‡ºé‡è¦è¦‹è§£ï¼Œèˆ‡<span class="case-highlight">é‡‹å­—ç¬¬582è™Ÿ</span>è§£é‡‹ç›¸é—œè¯ã€‚</p>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ”§ æ‰‹å‹•æ¸¬è©¦ç‰¹å®šæ¡ˆè™Ÿ</h2>
        <div class="manual-test">
            <h3>æŸ¥è©¢å®˜æ–¹è³‡æ–™åº«</h3>
            <p>
                <strong>å¹´åº¦ï¼š</strong><input type="text" id="testYear" value="110" placeholder="110">
                <strong>å­—åˆ¥ï¼š</strong><input type="text" id="testCaseType" value="å°ä¸Š" placeholder="å°ä¸Š">
                <strong>æ¡ˆè™Ÿï¼š</strong><input type="text" id="testNumber" value="1234" placeholder="1234">
            </p>
            <button onclick="testSpecificCase()">ğŸ” æŸ¥è©¢æ­¤æ¡ˆè™Ÿ</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤çµæœ</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3002'; // Updated to use port 3002

        // Check server health
        async function checkServerHealth() {
            const statusEl = document.getElementById('apiStatus');
            statusEl.className = 'api-status status-checking';
            statusEl.innerHTML = 'ğŸ”„ æª¢æŸ¥ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                statusEl.className = 'api-status status-success';
                statusEl.innerHTML = `âœ… æœå‹™å™¨æ­£å¸¸é‹è¡Œ - ${data.message} (${data.timestamp})`;
            } catch (error) {
                statusEl.className = 'api-status status-error';
                statusEl.innerHTML = `âŒ ç„¡æ³•é€£æ¥æœå‹™å™¨: ${error.message}<br><small>è«‹ç¢ºèªå·²åŸ·è¡Œ: <code>npm start</code></small>`;
            }
        }

        // Get database statistics
        async function getStats() {
            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = '<p>ğŸ”„ è¼‰å…¥è³‡æ–™åº«çµ±è¨ˆ...</p>';

            try {
                const response = await fetch(`${API_BASE}/api/stats`);
                const data = await response.json();

                let html = '<h3>ğŸ“Š è³‡æ–™åº«çµ±è¨ˆè³‡è¨Š</h3>';
                html += `<div class="status-success"><strong>æ¡ˆä»¶ç¸½æ•¸ï¼š</strong>${data.totalCases} ç­†</div>`;

                html += '<h4>ğŸ“… å¹´åº¦åˆ†å¸ƒï¼š</h4><ul>';
                Object.entries(data.yearDistribution).sort().forEach(([year, count]) => {
                    html += `<li>${year}å¹´ï¼š${count} ç­†</li>`;
                });
                html += '</ul>';

                html += '<h4>âš–ï¸ æ¡ˆä»¶é¡å‹åˆ†å¸ƒï¼š</h4><ul>';
                Object.entries(data.caseTypeDistribution).sort((a, b) => b[1] - a[1]).slice(0, 10).forEach(([type, count]) => {
                    html += `<li>${type}å­—ï¼š${count} ç­†</li>`;
                });
                html += '</ul>';

                html += `<div class="status-info"><small>æœ€å¾Œæ›´æ–°ï¼š${new Date(data.lastUpdated).toLocaleString()}</small></div>`;

                resultsEl.innerHTML = html;
            } catch (error) {
                resultsEl.innerHTML = `<div class="status-error">âŒ ç„¡æ³•å–å¾—çµ±è¨ˆè³‡æ–™: ${error.message}</div>`;
            }
        }

        // Manual sync
        async function manualSync() {
            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = '<div class="status-checking">ğŸ”„ æ‰‹å‹•åŒæ­¥å·²å•Ÿå‹•ï¼Œè«‹æŸ¥çœ‹æœå‹™å™¨æ§åˆ¶å°...</div>';

            try {
                const response = await fetch(`${API_BASE}/api/sync-now`, { method: 'POST' });
                const data = await response.json();
                resultsEl.innerHTML = `<div class="status-info">ğŸ“¡ ${data.message}</div>`;
            } catch (error) {
                resultsEl.innerHTML = `<div class="status-error">âŒ åŒæ­¥å¤±æ•—: ${error.message}</div>`;
            }
        }

        // Test specific case
        async function testSpecificCase() {
            const year = document.getElementById('testYear').value;
            const caseType = document.getElementById('testCaseType').value;
            const number = document.getElementById('testNumber').value;
            const resultsEl = document.getElementById('results');

            if (!year || !caseType || !number) {
                resultsEl.innerHTML = '<div class="status-error">âŒ è«‹å¡«å…¥æ‰€æœ‰æ¬„ä½</div>';
                return;
            }

            resultsEl.innerHTML = '<p>ğŸ”„ æŸ¥è©¢å®˜æ–¹è³‡æ–™åº«...</p>';

            try {
                const url = `${API_BASE}/api/case?year=${encodeURIComponent(year)}&caseType=${encodeURIComponent(caseType)}&number=${encodeURIComponent(number)}`;
                const response = await fetch(url);
                const result = await response.json();

                let html = '<h3>ğŸ” æŸ¥è©¢çµæœ</h3>';

                if (result.error) {
                    html += `<div class="status-error">âŒ ${result.error}</div>`;
                    if (result.suggestion) {
                        html += `<div class="status-info">ğŸ’¡ ${result.suggestion}</div>`;
                    }
                } else if (result.success && result.data) {
                    const data = result.data;
                    html += `<div class="status-success">âœ… æ‰¾åˆ°æ¡ˆä»¶è³‡æ–™ (ä¾†æºï¼š${result.source})</div>`;
                    html += `<div class="api-status status-info">`;
                    html += `<strong>æ¡ˆè™Ÿï¼š</strong>${data.JYEAR || year}å¹´åº¦${data.JCASE || caseType}å­—ç¬¬${data.JNO || number}è™Ÿ<br>`;
                    html += `<strong>æ¡ˆç”±ï¼š</strong>${data.JTITLE || 'N/A'}<br>`;
                    html += `<strong>æ³•é™¢ï¼š</strong>${data.JCOURT || 'N/A'}<br>`;
                    html += `<strong>å¯©ç†ç´šåˆ¥ï¼š</strong>${data.JLEVEL || 'N/A'}<br>`;
                    html += `<strong>è£åˆ¤æ—¥æœŸï¼š</strong>${data.JDATE || 'N/A'}<br>`;
                    html += `</div>`;

                    if (data.JFULLCONTENT) {
                        const content = data.JFULLCONTENT.substring(0, 500) + (data.JFULLCONTENT.length > 500 ? '...' : '');
                        html += `<h4>ğŸ“„ åˆ¤æ±ºå…§å®¹æ‘˜è¦ï¼š</h4><pre>${content}</pre>`;
                    }
                } else {
                    html += '<div class="status-error">âŒ ç„¡æ³•å–å¾—æ¡ˆä»¶è³‡æ–™</div>';
                }

                html += '<h4>ğŸ”§ å®Œæ•´APIå›æ‡‰ï¼š</h4>';
                html += `<pre>${JSON.stringify(result, null, 2)}</pre>`;

                resultsEl.innerHTML = html;
            } catch (error) {
                resultsEl.innerHTML = `<div class="status-error">âŒ æŸ¥è©¢å¤±æ•—: ${error.message}</div>`;
            }
        }

        // Clear results
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkServerHealth();
            console.log('ğŸš€ æ³•æºæ¢æ¸¬å™¨å®˜æ–¹APIæ¸¬è©¦é é¢å·²è¼‰å…¥');
            console.log('ğŸ“‹ é é¢åŒ…å«å¤šç¨®å°ç£æ³•å¾‹æ¡ˆè™Ÿæ ¼å¼ä¾›æ¸¬è©¦');
            console.log('ğŸŒ æ•´åˆå°ç£å¸æ³•é™¢å®˜æ–¹é–‹æ”¾è³‡æ–™API');

            // Auto-highlight case numbers for visual effect
            setTimeout(() => {
                document.querySelectorAll('.case-highlight').forEach((el, index) => {
                    setTimeout(() => {
                        el.style.background = '#74b9ff';
                        el.style.color = 'white';
                        el.style.transition = 'all 0.3s ease';
                        setTimeout(() => {
                            el.style.background = '#ffeaa7';
                            el.style.color = '#2d3436';
                        }, 300);
                    }, index * 100);
                });
            }, 1000);
        });
    </script>
</body>
</html>
